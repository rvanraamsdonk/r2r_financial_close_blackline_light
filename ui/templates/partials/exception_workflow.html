<!-- AI-Enhanced Exception Workflow -->
<div class="bg-white border border-gray-200 rounded-lg p-6">
  <div class="flex items-center justify-between mb-6">
    <h3 class="text-lg font-semibold text-gray-900">üéØ Exception Management Workflow</h3>
    <div class="flex items-center space-x-2">
      <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
        AI-Powered Resolution
      </span>
      <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
        {{ automation_status.confidence_score }}% Confidence
      </span>
    </div>
  </div>

  <!-- Bulk Actions Bar -->
  <div class="bg-gray-50 rounded-lg p-4 mb-6">
    <div class="flex items-center justify-between">
      <div class="flex items-center space-x-4">
        <label class="flex items-center">
          <input type="checkbox" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500" id="select-all">
          <span class="ml-2 text-sm text-gray-700">Select All ({{ exceptions.total_count }})</span>
        </label>
        <span class="text-sm text-gray-500">|</span>
        <span class="text-sm text-gray-600">0 selected</span>
      </div>
      <div class="flex items-center space-x-2">
        <button class="inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
          ü§ñ AI Bulk Resolve
        </button>
        <button class="inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
          üìù Create Journals
        </button>
        <button class="inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
          ‚úÖ Approve Selected
        </button>
      </div>
    </div>
  </div>

  <!-- Exception Queue with AI Suggestions -->
  <div class="space-y-4">
    {% if exceptions.critical %}
    <!-- Critical Exceptions -->
    <div class="border border-red-200 rounded-lg">
      <div class="bg-red-50 px-4 py-3 border-b border-red-200">
        <h4 class="text-sm font-medium text-red-800">üö® Critical Exceptions ({{ exceptions.critical|length }})</h4>
      </div>
      <div class="divide-y divide-red-100">
        {% for exc in exceptions.critical %}
        <div class="p-4 hover:bg-red-25">
          <div class="flex items-start justify-between">
            <div class="flex items-start space-x-3">
              <input type="checkbox" class="mt-1 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
              <div class="flex-1">
                <div class="flex items-center space-x-2">
                  <h5 class="text-sm font-medium text-gray-900">{{ exc.category }}</h5>
                  <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800">
                    {{ exc.count }} items
                  </span>
                  <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-orange-100 text-orange-800">
                    High Priority
                  </span>
                </div>
                <p class="mt-1 text-sm text-gray-600">AI Analysis: Requires immediate attention due to materiality and risk factors.</p>
                
                <!-- AI Suggested Actions -->
                <div class="mt-3 bg-blue-50 border border-blue-200 rounded p-3">
                  <div class="flex items-center space-x-2 mb-2">
                    <span class="text-xs font-medium text-blue-800">ü§ñ AI Suggested Resolution:</span>
                    <span class="inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800">
                      92% Confidence
                    </span>
                  </div>
                  <p class="text-sm text-blue-800">Create manual journal entry for ${{ "{:,.0f}".format(12500) }} with supporting documentation. Escalate to senior reviewer for approval.</p>
                  <div class="mt-2 flex items-center space-x-2">
                    <button class="inline-flex items-center px-2 py-1 border border-blue-300 shadow-sm text-xs font-medium rounded text-blue-700 bg-white hover:bg-blue-50">
                      üìù Create JE
                    </button>
                    <button class="inline-flex items-center px-2 py-1 border border-blue-300 shadow-sm text-xs font-medium rounded text-blue-700 bg-white hover:bg-blue-50">
                      üë§ Assign Reviewer
                    </button>
                    <button class="inline-flex items-center px-2 py-1 border border-blue-300 shadow-sm text-xs font-medium rounded text-blue-700 bg-white hover:bg-blue-50">
                      üîç View Details
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <div class="flex items-center space-x-2">
              <span class="text-xs text-gray-500">2 min ago</span>
              <div class="w-2 h-2 bg-red-400 rounded-full"></div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}

    {% if exceptions.medium %}
    <!-- Medium Exceptions -->
    <div class="border border-yellow-200 rounded-lg">
      <div class="bg-yellow-50 px-4 py-3 border-b border-yellow-200">
        <h4 class="text-sm font-medium text-yellow-800">‚ö†Ô∏è Medium Exceptions ({{ exceptions.medium|length }})</h4>
      </div>
      <div class="divide-y divide-yellow-100">
        {% for exc in exceptions.medium %}
        <div class="p-4 hover:bg-yellow-25">
          <div class="flex items-start justify-between">
            <div class="flex items-start space-x-3">
              <input type="checkbox" class="mt-1 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
              <div class="flex-1">
                <div class="flex items-center space-x-2">
                  <h5 class="text-sm font-medium text-gray-900">{{ exc.category }}</h5>
                  <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-100 text-yellow-800">
                    {{ exc.count }} items
                  </span>
                  <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800">
                    Auto-Resolvable
                  </span>
                </div>
                <p class="mt-1 text-sm text-gray-600">AI Analysis: Minor variances within acceptable tolerance. Can be auto-resolved with proper documentation.</p>
                
                <!-- AI Auto-Resolution -->
                <div class="mt-3 bg-green-50 border border-green-200 rounded p-3">
                  <div class="flex items-center space-x-2 mb-2">
                    <span class="text-xs font-medium text-green-800">‚úÖ AI Auto-Resolution Available:</span>
                    <span class="inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800">
                      96% Confidence
                    </span>
                  </div>
                  <p class="text-sm text-green-800">Automatic journal entry for immaterial differences. No manual intervention required.</p>
                  <div class="mt-2 flex items-center space-x-2">
                    <button class="inline-flex items-center px-2 py-1 border border-green-300 shadow-sm text-xs font-medium rounded text-green-700 bg-white hover:bg-green-50">
                      ‚ö° Auto-Resolve
                    </button>
                    <button class="inline-flex items-center px-2 py-1 border border-green-300 shadow-sm text-xs font-medium rounded text-green-700 bg-white hover:bg-green-50">
                      üìã View Rationale
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <div class="flex items-center space-x-2">
              <span class="text-xs text-gray-500">5 min ago</span>
              <div class="w-2 h-2 bg-yellow-400 rounded-full"></div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}
  </div>

  <!-- Workflow Progress -->
  <div class="mt-6 bg-gray-50 rounded-lg p-4">
    <div class="flex items-center justify-between mb-3">
      <h4 class="text-sm font-medium text-gray-900">Exception Resolution Progress</h4>
      <span class="text-sm text-gray-600">{{ ((exceptions.total_count - exceptions.critical|length) / exceptions.total_count * 100)|round(1) }}% Auto-Resolvable</span>
    </div>
    <div class="w-full bg-gray-200 rounded-full h-2">
      <div class="bg-green-600 h-2 rounded-full" style="width: {{ ((exceptions.total_count - exceptions.critical|length) / exceptions.total_count * 100)|round(1) }}%"></div>
    </div>
    <div class="mt-2 flex justify-between text-xs text-gray-600">
      <span>{{ exceptions.total_count - exceptions.critical|length }} auto-resolvable</span>
      <span>{{ exceptions.critical|length }} require review</span>
    </div>
  </div>

  <!-- Next Actions -->
  <div class="mt-6 flex items-center justify-between">
    <div class="flex items-center space-x-4">
      <span class="text-sm text-gray-600">Next recommended action:</span>
      <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
        ü§ñ Bulk auto-resolve {{ exceptions.medium|length }} medium exceptions
      </span>
    </div>
    <button class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
      Execute AI Recommendations
    </button>
  </div>
</div>
